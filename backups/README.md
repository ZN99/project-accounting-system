# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ»ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ 

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
backups/
â”œâ”€â”€ README.md                              # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
â”œâ”€â”€ test_data_comprehensive.json           # ç¶²ç¾…çš„ãªãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
â”œâ”€â”€ test_data_comprehensive_metadata.json  # ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ãƒ¡ã‚¿æƒ…å ±
â”œâ”€â”€ backup_YYYYMMDD_HHMMSS.zip            # è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ï¼ˆZIPå½¢å¼ï¼‰
â””â”€â”€ *.csv                                  # CSVã‚¤ãƒ³ãƒãƒ¼ãƒˆç”¨ãƒ•ã‚¡ã‚¤ãƒ«
```

## ğŸ¯ ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®æ¦‚è¦

### ç”Ÿæˆã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿

**test_data_comprehensive.json** ã«ã¯ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¾ã™:

- **å…ƒè«‹ä¼šç¤¾**: 8ç¤¾
  - å¤§æˆå»ºè¨­ã€é¹¿å³¶å»ºè¨­ã€æ¸…æ°´å»ºè¨­ã€ç«¹ä¸­å·¥å‹™åº—ãªã©
  - æ”¯æ‰•ã„ã‚µã‚¤ã‚¯ãƒ«ã€ç· ã‚æ—¥ã€æ”¯æ‰•æ—¥ãªã©ã®è¨­å®šå«ã‚€

- **ä¸‹è«‹ã‘æ¥­è€…**: 8ç¤¾
  - é›»æ°—å·¥äº‹ã€é…ç®¡ãƒ»è¨­å‚™ã€å¡—è£…ã€å»ºæä¾›çµ¦ãªã©å„ç¨®å°‚é–€æ¥­è€…
  - æ™‚é–“å˜ä¾¡ã€å°‚é–€åˆ†é‡ã®è¨­å®šå«ã‚€

- **æ¡ˆä»¶**: 20ä»¶
  - éå»ãƒ»ç¾åœ¨ãƒ»æœªæ¥ã®ãƒ‡ãƒ¼ã‚¿ã‚’å«ã‚€ç¾å®Ÿçš„ãªæ¡ˆä»¶
  - ãƒã‚¦ã‚¹ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ã€ã‚¯ãƒ­ã‚¹å¼µã‚Šæ›¿ãˆã€é›»æ°—å·¥äº‹ãªã©å¤šæ§˜ãªå·¥äº‹å†…å®¹
  - å—æ³¨é‡‘é¡: Â¥0ã€œÂ¥361,000

- **é€²æ—ã‚¹ãƒ†ãƒƒãƒ—**: 40ä»¶
  - ç€å·¥æ—¥ãƒ»å®Œå·¥æ—¥ã®è¨­å®š
  - å®Œäº†æ¸ˆã¿ãƒ»é€²è¡Œä¸­ãƒ»æœªç€æ‰‹ã®ãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³

- **ä¸‹è«‹ã‘å¥‘ç´„**: 41ä»¶
  - æ¡ˆä»¶ã¨æ¥­è€…ã®ç´ä»˜ã‘
  - å¥‘ç´„é‡‘é¡ã€è«‹æ±‚é‡‘é¡ã®è¨­å®š

### ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿

**test_data_comprehensive_metadata.json** ã®ä¾‹:
```json
{
  "backup_version": "1.0",
  "created_at": "2025-12-22",
  "total_records": 117,
  "models": {
    "client_companies": 8,
    "contractors": 8,
    "projects": 20,
    "progress_steps": 40,
    "subcontracts": 41
  }
}
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®ç”Ÿæˆ

æ–°ã—ã„ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç”Ÿæˆã™ã‚‹å ´åˆ:

```bash
# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‡ºåŠ› (backups/test_data_comprehensive.json)
python manage.py create_test_data

# ã‚«ã‚¹ã‚¿ãƒ å‡ºåŠ›å…ˆ
python manage.py create_test_data --output backups/my_test_data.json

# æ—¢å­˜ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¦ã‹ã‚‰ç”Ÿæˆï¼ˆæ³¨æ„: å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼‰
python manage.py create_test_data --clear
```

**ç”Ÿæˆçµæœ:**
```
======================================================================
ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆé–‹å§‹
======================================================================

ğŸ“Š å…ƒè«‹ä¼šç¤¾ã‚’ä½œæˆä¸­...
  âœ“ å…ƒè«‹ä¼šç¤¾: 8ç¤¾ä½œæˆå®Œäº†

ğŸ‘· ä¸‹è«‹ã‘æ¥­è€…ã‚’ä½œæˆä¸­...
  âœ“ ä¸‹è«‹ã‘æ¥­è€…: 8ç¤¾ä½œæˆå®Œäº†

ğŸ—ï¸  æ¡ˆä»¶ã‚’ä½œæˆä¸­...
  âœ“ æ¡ˆä»¶: 20ä»¶ä½œæˆå®Œäº†

ğŸ“ˆ é€²æ—ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½œæˆä¸­...
  âœ“ é€²æ—ã‚¹ãƒ†ãƒƒãƒ—: 40ä»¶ä½œæˆå®Œäº†

ğŸ“ ä¸‹è«‹ã‘å¥‘ç´„ã‚’ä½œæˆä¸­...
  âœ“ ä¸‹è«‹ã‘å¥‘ç´„: 41ä»¶ä½œæˆå®Œäº†

ğŸ’¾ JSONå‡ºåŠ›ä¸­: backups/test_data_comprehensive.json
  âœ“ ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›: backups/test_data_comprehensive.json
  âœ“ ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿: backups/test_data_comprehensive_metadata.json

======================================================================
âœ… ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ç”Ÿæˆå®Œäº†
======================================================================
```

### 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿

#### æ–¹æ³•A: ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚€
python manage.py loaddata backups/test_data_comprehensive.json
```

**æˆåŠŸæ™‚ã®å‡ºåŠ›:**
```
Installed 117 object(s) from 1 fixture(s)
```

#### æ–¹æ³•B: Web UI

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ **http://localhost:8000/orders/import-data/** ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€Œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã€ã‚’ã‚¯ãƒªãƒƒã‚¯
3. `backups/test_data_comprehensive.json` ã‚’é¸æŠ
4. ã€Œã‚¤ãƒ³ãƒãƒ¼ãƒˆé–‹å§‹ã€ã‚’ã‚¯ãƒªãƒƒã‚¯

**çµæœ:**
```json
{
  "status": "success",
  "message": "ãƒ‡ãƒ¼ã‚¿ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆãŒå®Œäº†ã—ã¾ã—ãŸ",
  "details": "117å€‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸ",
  "warnings": "âš ï¸ ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¾©å…ƒã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚ZIPãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚"
}
```

#### æ–¹æ³•C: é¸æŠçš„ãƒªã‚¹ãƒˆã‚¢ï¼ˆç‰¹å®šãƒ¢ãƒ‡ãƒ«ã®ã¿ï¼‰

1. ãƒ–ãƒ©ã‚¦ã‚¶ã§ **http://localhost:8000/orders/selective-restore/** ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. å¾©å…ƒã™ã‚‹ãƒ¢ãƒ‡ãƒ«ã‚’é¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
4. ã€Œé¸æŠã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å¾©å…ƒã€ã‚’ã‚¯ãƒªãƒƒã‚¯

**ç”¨é€”:**
- ä¸‹è«‹ã‘æ¥­è€…ã®ã¿ã‚’è¿½åŠ 
- å…ƒè«‹ä¼šç¤¾ã®ã¿ã‚’å¾©å…ƒ
- ç‰¹å®šã®ãƒ¢ãƒ‡ãƒ«ã ã‘ã‚’é¸æŠçš„ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆ

### 3. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—

ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹å ´åˆ:

#### ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³:
```bash
# ZIPå½¢å¼ï¼ˆdata.json + metadata.json + media/ï¼‰
python manage.py backup_data --output backups/my_backup.zip

# JSONå½¢å¼ã®ã¿ï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
python manage.py dumpdata \
  --exclude sessions \
  --exclude admin.logentry \
  --indent 2 \
  --output backups/my_backup.json
```

#### Web UI:
1. **http://localhost:8000/orders/export-data/** ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹

**ãƒ•ã‚¡ã‚¤ãƒ«å:** `backup_20251222_123456.zip`

### 4. å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆãƒ†ã‚¹ãƒˆç’°å¢ƒã®ãƒªã‚»ãƒƒãƒˆï¼‰

âš ï¸ **å±é™ºãªæ“ä½œ**: å…¨ãƒ‡ãƒ¼ã‚¿ãŒå‰Šé™¤ã•ã‚Œã¾ã™ï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«ã¯ä¿æŒï¼‰

```bash
# Web UIã§å‰Šé™¤ï¼ˆæ¨å¥¨ - å‰Šé™¤å‰ã«è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼‰
# http://localhost:8000/orders/delete-all-data/
```

**æ‰‹é †:**
1. å‰Šé™¤å¯¾è±¡ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ç¢ºèª
2. ç¢ºèªã‚³ãƒ¼ãƒ‰ `DELETE` ã‚’å…¥åŠ›
3. å‰Šé™¤å®Ÿè¡Œï¼ˆè‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒä½œæˆã•ã‚Œã‚‹ï¼‰

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ç¢ºèª

ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãŒæ­£ã—ãèª­ã¿è¾¼ã¾ã‚ŒãŸã‹ç¢ºèª:

```bash
# Django shell ã§ç¢ºèª
python manage.py shell

>>> from order_management.models import Project, ClientCompany
>>> from subcontract_management.models import Contractor

>>> # ä»¶æ•°ç¢ºèª
>>> Project.objects.count()
20

>>> ClientCompany.objects.count()
8

>>> Contractor.objects.count()
8

>>> # ãƒ‡ãƒ¼ã‚¿å†…å®¹ç¢ºèª
>>> Project.objects.first()
<Project: M250001 - ä¸¸å±±ã‚·ãƒ£ãƒ³ãƒ†104 ã‚¯ãƒ­ã‚¹å¼µã‚Šæ›¿ãˆ>

>>> ClientCompany.objects.first()
<ClientCompany: K2ãƒ—ãƒ©ãƒãƒƒãƒˆæ ªå¼ä¼šç¤¾>
```

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚¨ãƒ©ãƒ¼: "RuntimeWarning: DateTimeField received a naive datetime"

**åŸå› :** completed_dateãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒtimezone-awareãªdatetimeã‚’æœŸå¾…ã—ã¦ã„ã‚‹ã®ã«ã€naiveãªdatetimeãŒæ¸¡ã•ã‚Œã¦ã„ã‚‹

**è§£æ±ºæ¸ˆã¿:** create_test_dataã‚³ãƒãƒ³ãƒ‰ã¯ä¿®æ­£æ¸ˆã¿ï¼ˆtimezone.make_awareä½¿ç”¨ï¼‰

### ã‚¨ãƒ©ãƒ¼: "Installed 0 object(s)"

**åŸå› :** JSONãƒ•ã‚¡ã‚¤ãƒ«ãŒç©ºã€ã¾ãŸã¯å½¢å¼ãŒä¸æ­£

**è§£æ±ºæ–¹æ³•:**
1. JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’ç¢ºèª: `cat backups/test_data_comprehensive.json | head`
2. å†ç”Ÿæˆ: `python manage.py create_test_data`

### ã‚¨ãƒ©ãƒ¼: "FK constraint violation"

**åŸå› :** å¤–éƒ¨ã‚­ãƒ¼åˆ¶ç´„é•åï¼ˆå‚ç…§å…ˆã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒå­˜åœ¨ã—ãªã„ï¼‰

**è§£æ±ºæ–¹æ³•:**
1. ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ãªçŠ¶æ…‹ã«ã™ã‚‹
2. `/orders/delete-all-data/` ã§å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
3. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å†èª­ã¿è¾¼ã¿

### è­¦å‘Š: "URL namespace 'order_management' isn't unique"

**å½±éŸ¿:** å®Ÿè¡Œã«ã¯å•é¡Œãªã—ï¼ˆDjangoè¨­å®šã®è­¦å‘Šï¼‰

**ç„¡è¦–ã—ã¦è‰¯ã„:** loaddataã®å®Ÿè¡Œã«ã¯å½±éŸ¿ã—ã¾ã›ã‚“

## ğŸ“ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

### 1. é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. ã‚¯ãƒªãƒ¼ãƒ³ãªç’°å¢ƒã‚’æº–å‚™
./scripts/init.sh

# 2. ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
python manage.py loaddata backups/test_data_comprehensive.json

# 3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
./scripts/start.sh
```

### 2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œå‰

```bash
# 1. ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
python manage.py backup_data --output backups/before_test.zip

# 2. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
python manage.py test

# 3. å¿…è¦ã«å¿œã˜ã¦å¾©å…ƒ
python manage.py loaddata backups/before_test.zip
```

### 3. æœ¬ç•ªç’°å¢ƒã¸ã®ãƒ‡ãƒ—ãƒ­ã‚¤å‰

```bash
# 1. æœ¬ç•ªãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
python manage.py backup_data --output backups/production_$(date +%Y%m%d).zip

# 2. ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ
python manage.py migrate

# 3. å‹•ä½œç¢ºèª
python manage.py check
```

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **CLAUDE.md** - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã®ã‚¬ã‚¤ãƒ‰
- **ARCHITECTURE_ANALYSIS.md** - ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è©³ç´°
- **progress.md** - ã‚»ãƒƒã‚·ãƒ§ãƒ³ã”ã¨ã®é€²æ—è¨˜éŒ²
- **order_management/views_backup.py** - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ãƒªã‚¹ãƒˆã‚¢ãƒ“ãƒ¥ãƒ¼ã®å®Ÿè£…

## ğŸ”— Web UI ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ**: `/orders/export-data/`
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¤ãƒ³ãƒãƒ¼ãƒˆ**: `/orders/import-data/`
- **é¸æŠçš„ãƒªã‚¹ãƒˆã‚¢**: `/orders/selective-restore/`
- **å…¨ãƒ‡ãƒ¼ã‚¿å‰Šé™¤**: `/orders/delete-all-data/`

---

**æœ€çµ‚æ›´æ–°:** 2025-12-22
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 1.0
